{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nimport React, { Component } from 'react';\nimport StaticContainer from \"./StaticContainer\";\nimport { RootControllerChanges } from \"./RootController\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar _default = function (_Component) {\n  _inherits(_default, _Component);\n  var _super = _createSuper(_default);\n  function _default(props) {\n    var _this;\n    _classCallCheck(this, _default);\n    _this = _super.call(this, props);\n    _this.siblingsPool = [];\n    _this.updatedSiblings = new Set();\n    _this.unmounted = false;\n    _this.state = {\n      siblings: []\n    };\n    return _this;\n  }\n  _createClass(_default, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n      this.props.controller.setCallback(function (id, change) {\n        setImmediate(function () {\n          return _this2.commitChange(id, change);\n        });\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.updatedSiblings.clear();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unmounted = true;\n    }\n  }, {\n    key: \"commitChange\",\n    value: function commitChange(id, _ref) {\n      var _this3 = this;\n      var change = _ref.change,\n        element = _ref.element,\n        updateCallback = _ref.updateCallback;\n      if (this.unmounted) {\n        return;\n      }\n      var siblings = Array.from(this.siblingsPool);\n      var index = siblings.findIndex(function (sibling) {\n        return sibling.id === id;\n      });\n      if (change === RootControllerChanges.Remove) {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else if (change === RootControllerChanges.Update) {\n        if (index > -1) {\n          siblings.splice(index, 1, {\n            element: element,\n            id: id\n          });\n          this.updatedSiblings.add(id);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        }\n        siblings.push({\n          element: element,\n          id: id\n        });\n        this.updatedSiblings.add(id);\n      }\n      this.siblingsPool = siblings;\n      this.setState({\n        siblings: siblings\n      }, function () {\n        return _this3.invokeCallback(updateCallback);\n      });\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(callback) {\n      if (callback) {\n        callback();\n      }\n    }\n  }, {\n    key: \"renderSiblings\",\n    value: function renderSiblings() {\n      var _this4 = this;\n      return this.state.siblings.map(function (_ref2) {\n        var id = _ref2.id,\n          element = _ref2.element;\n        return _jsx(StaticContainer, {\n          shouldUpdate: _this4.updatedSiblings.has(id),\n          children: _this4.wrapSibling(element)\n        }, \"root-sibling-\" + id);\n      });\n    }\n  }, {\n    key: \"wrapSibling\",\n    value: function wrapSibling(element) {\n      var renderSibling = this.props.renderSibling;\n      if (renderSibling) {\n        return renderSibling(element);\n      } else {\n        return element;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _jsxs(_Fragment, {\n        children: [this.props.children, this.renderSiblings()]\n      });\n    }\n  }]);\n  return _default;\n}(Component);\nexport { _default as default };","map":{"version":3,"mappings":"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","names":["React","Component","StaticContainer","RootControllerChanges","props","Set","state","siblings","controller","setCallback","id","change","setImmediate","commitChange","updatedSiblings","clear","unmounted","element","updateCallback","Array","from","siblingsPool","index","findIndex","sibling","Remove","splice","invokeCallback","Update","add","push","setState","callback","map","has","wrapSibling","renderSibling","children","renderSiblings"],"sourceRoot":"","sources":["../src/RootSiblings.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}